from privlib.riskAssessment import constants
from privlib.riskAssessment.sequentialprivacyframe import SequentialPrivacyFrame as SPF
import numpy as np
import pandas as pd
import unittest

class TestSPF(unittest.TestCase):

    def setUp(self):
        lat_lons = np.array([[43.8430139, 10.5079940],
                             [43.5442700, 10.3261500],
                             [43.7085300, 10.4036000],
                             [43.7792500, 11.2462600],
                             [43.8430139, 10.5079940],
                             [43.7085300, 10.4036000],
                             [43.8430139, 10.5079940],
                             [43.5442700, 10.3261500],
                             [43.5442700, 10.3261500],
                             [43.7085300, 10.4036000],
                             [43.8430139, 10.5079940],
                             [43.7792500, 11.2462600],
                             [43.7085300, 10.4036000],
                             [43.5442700, 10.3261500],
                             [43.7792500, 11.2462600],
                             [43.7085300, 10.4036000],
                             [43.7792500, 11.2462600],
                             [43.8430139, 10.5079940],
                             [43.8430139, 10.5079940],
                             [43.5442700, 10.3261500]])

        traj = pd.DataFrame(lat_lons, columns=['lat', 'lon'])

        traj[constants.DATETIME] = pd.to_datetime([
            '20110203 8:34:04', '20110203 9:34:04', '20110203 10:34:04', '20110204 10:34:04',
            '20110203 8:34:04', '20110203 9:34:04', '20110204 10:34:04', '20110204 11:34:04',
            '20110203 8:34:04', '20110203 9:34:04', '20110204 10:34:04', '20110204 11:34:04',
            '20110204 10:34:04', '20110204 11:34:04', '20110204 12:34:04',
            '20110204 10:34:04', '20110204 11:34:04', '20110205 12:34:04',
            '20110204 10:34:04', '20110204 11:34:04'])

        traj[constants.USER_ID] = [1 for _ in range(4)] + [2 for _ in range(4)] + \
                        [3 for _ in range(4)] + [4 for _ in range(3)] + \
                        [5 for _ in range(3)] + [6 for _ in range(2)]

        lat_lons_2 = np.array([[43.8430139, 10.5079940],
                               [43.8430139, 10.5079940],
                               [43.8430139, 10.5079940],
                               [43.8430139, 10.5079940],
                               [43.8430139, 10.5079940],
                               [43.5442700, 10.3261500],
                               [43.5442700, 10.3261500],
                               [43.5442700, 10.3261500],
                               [43.5442700, 10.3261500],
                               [43.7085300, 10.4036000],
                               [43.7085300, 10.4036000],

                               [43.7792500, 11.2462600],
                               [43.8430139, 10.5079940],
                               [43.7792500, 11.2462600],
                               [43.8430139, 10.5079940],

                               [43.8430139, 10.5079940],
                               [43.8430139, 10.5079940],
                               [43.8430139, 10.5079940],
                               [43.8430139, 10.5079940],
                               [43.8430139, 10.5079940],
                               [43.5442700, 10.3261500],
                               [43.5442700, 10.3261500],
                               [43.5442700, 10.3261500],
                               [43.5442700, 10.3261500],

                               [43.8430139, 10.5079940],
                               [43.8430139, 10.5079940],
                               [43.8430139, 10.5079940],
                               [43.8430139, 10.5079940],
                               [43.8430139, 10.5079940],
                               [43.8430139, 10.5079940],
                               [43.7085300, 10.4036000],
                               [43.5442700, 10.3261500],
                               [43.7085300, 10.4036000],
                               [43.5442700, 10.3261500],
                               [43.7085300, 10.4036000],
                               [43.5442700, 10.3261500]])

        trj2 = pd.DataFrame(lat_lons_2, columns=['lat', 'lng'])

        trj2[constants.DATETIME] = pd.to_datetime(['20110203 8:34:04' for _ in range(36)])

        trj2[constants.USER_ID] = [1 for _ in range(11)] + [2 for _ in range(4)] + \
                        [3 for _ in range(9)] + [4 for _ in range(12)]

        self.fist_df = traj
        self.second_df = trj2

        self.first_instance = traj[:2].values
        self.second_instance = pd.concat([traj[0:1], traj[3:4]]).values

    def test_spf(self):
        spf = SPF(self.fist_df, user_id='uid', datetime='datetime', elements=['lat', 'lng'])
        self.assertEqual(spf.columns, pd.Index(['datetime', 'uid', 'elements', 'sequence', 'order'], dtype='object'))

if __name__ == '__main__':
    unittest.main()